##### Kafka的分区设计
1. 生产者并行写入受到分区数量的限制。
2. 消费者并行消费也受到消费分区数量限制。假设分区数量是20，则最大并发消费的消费者数量也是20.
3. 每个主题都包含固定数量的分区。分区数量决定单个中间件可能具有的不会显著影响性能的最大主题数量
##### 如何选择kafka集群中的主题/分区数量？
1. 更多的分区数量可以提高吞吐量
> 主题分区是Kafka中并行度的单位，在生产者和中间件端，对不同分区的写入可以完全并行完成。在消费者端，Kafka总是将
一个分区的数据提供给一个消费者线程。因此，消费者(在消费者组内)的并行度受到消费分区的数量限制。所以，在Kafka集群
中的分区越多，实现的吞吐量就越高。

> 选择分区数量的粗略公式基于吞吐量。可以在单个分区中对实现的生产者P和消费者C进行测量吞吐量T。然后你至少需要
max(T/P,T/C)的分区数量，在生产者上实现的单个分区的吞吐量取决于一些配置，如：批处理大小，压缩编解码器，ack类型，
复制因子等。但是一般情况下，如本基准测试所示，只能在一个分区上以10 MB/S 的速度生成。      
消费者的吞吐量通常取决于应用程序，因为它对应于消费者逻辑处理每条消息的速度。需要实际测量。

> 尽管随着时间的推移可以增加分区数量，但如果是使用Key生产消息，必须要小心。在发布消息时，Kafka根据Key的
哈希值明确地将消息映射到对应分区。这样可以保证具有相同Key的消息始终路由到同一分区。这种保证对于某些应用程序很重要
，因为分区内的消息总是按照消费者的要求传递。如果分区数量改变，这种保证可能不再使用。为了避免这种情况，一种常见的
做法是过度分区。基本上，你需要根据后续一两年的吞吐量来确定分区数量，最初，你可以根据当前吞吐量设置一个小型的Kafka
集群，一段时间后，你可以向集群中添加更多的中间件，并按照比例将现有分区的子集移动到新的中间件中。（可以在线完成）。
这样，你就可以在使用Key不破坏应用程序语义的情况下，继续保持吞吐量的增长。

##### 更多分区需要打开更多文件句柄
> 每一个分区都对应中间件文件系统中的目录。在一个日志目录中
